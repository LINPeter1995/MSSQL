1--	Module 6   T-SQL ?{???????~?T??
--		6-1: ???~?T?????????£Z????????
--		6-2: ?z?LERROR_XXX()?t?£Z????o???~?T??
--		6-3: ?t?£Z??@@ERROR ?PERROR_NUMBER()???????t??

--	???~?T???s?? : ?£Z??????~?T???????????@???~???X
--	https://docs.microsoft.com/zh-tw/sql/relational-databases/errors-events/database-engine-events-and-errors?view=sql-server-ver15

--  ???~?T???Y????h??(Seveirity) : ?|??^?Y????C???d??0-24, ???Y????C (??p : 0~9) ?????~
--					????O "???T??" ?? "?C????i" , ?Y??????????~???????????B?z?????D
-- https://docs.microsoft.com/zh-tw/sql/relational-databases/errors-events/database-engine-error-severities?view=sql-server-ver15


--	01.Demo - Error types and Severities.sql
-- Step 1: Open a new query window to MarketDev
use  AdventureWorks ;
go

-- Step 2: Note the returned error from a "syntax error"
--              ??? WebSite ???~?T???s??

selec  *  from  Person.Person ;  --  'selec' ???? '*' ???B???y?k?????T?C
go

-- Step 3: Note the returned error from an "object resolution error"
--              Describe each returned entry in the error message
select  *  from  Dog ;						-- ?L???????W?? 'Dog'
go


-- Step 4: Note the returned error from a runtime error
--              Describe each returned entry in the error message
--              and show how double-clicking the error in the messages
--              tab takes you directly to the error
select  12/0 ;								-- ?o?{???H?s?????~?C
go

select * from  sys.messages


-- Step 5: Query the contents of the sys.messages view
--              Note the language_id settings
select * from sys.messages 
where language_id=1028						-- ????
order by language_id, message_id;
go

-- Step 6: Query the English messages only with severity 19 or above. 
--              Note the is_event_logged column
select * from  sys.messages
where  language_id = 1033 and  severity >= 19			-- ?^??
order by  severity,  message_id ;


select * from  sys.messages
where  language_id = 1028 and severity >= 19
order by severity,  message_id ;


-- ?Q?? sp_AddMessage????q???~?T??,  ???~?N?X?????? 50001 ?}?l
-- ?z???????[?J???T???? us_english ?????~??[?J '?c?ì\??' ?????C

-- sp_addmessage 
--    [ @msgnum = ] msg_id , 
--    [ @severity = ] severity , 
--    [ @msgtext = ] 'msg'
--    [ , [ @lang = ] 'language' ]
--    [ , [ @with_log = ] 'with_log' ]
--    [ , [ @replace = ] 'replace' ]

--  msg_id		?G?o?O?T??????O?X?C????w?q???~?T???? msg_id 
--						?????O 50,001 ~ 2,147,483,647 ?????????C
--  severity	?G?o?O???~???Y????h??C??????h??d??O 1 ~ 24?C
--  msg			?G?o?O???~?T??????r?C msg ?O nvarchar(255)?A?w?]??O NULL?C
--  language	?G?T?????y???C
--  with_log	?G?T???X?{??A?O?_?N?T???g?J Windows ???£`{???O??????C
--  replace	?G?p?G???w?? replace ?r??A?N?|?H?s???T????r?M?Y????h?????g?{???????~?T???C
--						?[?J?o????A????O?n?????~?T???C

--delete from sys.messages
--where message_id >50000

exec sp_AddMessage 	
	@msgnum = 50003, 
	@severity = 16,
    @msgtext = N'The New Employee (%s) is Exist.',
	@lang = 'us_english'

exec sp_addmessage 
	@msgnum = 50003, 
	@severity = 16,
    @msgtext = N'?s?W???u(%1!)?w?s?b',
	@lang = N'?c?ì\??'

-- ?[??@?U 50003

select * from  sys.messages
where  message_id>49958


-- raise error 50001
raiserror(50003,12,1, 'John')



--  ?R????q???~?T??
--  sp_dropmessage ?G?R????q???~?T??
--  sp_dropmessage [ @msgnum = ] message_number 
--								[ , [ @lang = ] 'language'?Uall ]   --all:?R??????y??????
exec sp_dropmessage 50003, @lang='all'

select * from  sys.messages
where  message_id>49958
